{% extends "base.html" %}
{% block content %}
<div class="grid md:grid-cols-3 gap-6">
  <div class="col-span-2 card">
    <h1 class="text-2xl font-bold">{{ project.title }}</h1>
    <p class="text-sm text-gray-600">{{ project.location }} • {{ project.get_project_type_display }}</p>
    <p class="mt-4">{{ project.description }}</p>

    <h3 class="mt-6 font-semibold">Listings</h3>
    <div class="mt-3">
      {% for l in listings %}
        <div class="border rounded p-3 mb-3">
          <div class="flex justify-between">
            <div>
              <div class="font-semibold">${{ l.price_per_credit }} / ton</div>
              <div class="text-sm text-gray-600">Available: {{ l.available_credits }} tCO₂</div>
            </div>
            <div class="text-right">
              {% if user.is_authenticated %}
                <form method="post" action="{% url 'market:cart' %}">
                  {% csrf_token %}
                  <input type="hidden" name="listing_id" value="{{ l.id }}">
                  <label class="text-sm block">Credits to buy</label>
                  <input type="number" name="credits" min="1" max="{{ l.available_credits }}" value="1" class="border rounded p-1 w-24">
                  <button class="mt-2 bg-green-600 text-white px-3 py-1 rounded">Add & Checkout</button>
                </form>
              {% else %}
                <a href="{% url 'login' %}" class="text-sm text-green-600 hover:underline">Login to buy</a>
              {% endif %}
            </div>
          </div>
        </div>
      {% empty %}
        <p>No active listings for this project yet.</p>
      {% endfor %}
    </div>
  </div>

  <aside class="card">
    <h4 class="font-semibold">Project info</h4>
    <p class="text-sm mt-2">Owner: {{ project.owner.username }}</p>
    <p class="text-sm">Created: {{ project.created_at|date:"Y-m-d" }}</p>
  </aside>
</div>
{% endblock %}
